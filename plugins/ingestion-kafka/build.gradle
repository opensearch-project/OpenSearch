/*
* SPDX-License-Identifier: Apache-2.0
*
* The OpenSearch Contributors require contributions made to
* this file be licensed under the Apache-2.0 license or a
* compatible open source license.
*
* Modifications Copyright OpenSearch Contributors. See
* GitHub history for details.
*/

apply plugin: 'opensearch.internal-cluster-test'

opensearchplugin {
  description 'Pull-based ingestion plugin to consume from Kafka'
  classname 'org.opensearch.plugin.kafka.KafkaPlugin'
}

versions << [
  'kafka': '2.8.2',
  'docker': '3.3.6',
  'testcontainers': '1.19.7',
  'ducttape': '1.0.8',
]

dependencies {
  // kafka
  api "org.slf4j:slf4j-api:${versions.slf4j}"
  api "org.apache.kafka:kafka-clients:${versions.kafka}"

  // test
  api "com.github.docker-java:docker-java-api:${versions.docker}"
  testImplementation "com.github.docker-java:docker-java-transport:${versions.docker}"
  testImplementation "com.github.docker-java:docker-java-transport-zerodep:${versions.docker}"
  testImplementation "com.fasterxml.jackson.core:jackson-annotations:${versions.jackson}"
  testImplementation "org.testcontainers:testcontainers:${versions.testcontainers}"
  testImplementation "org.testcontainers:kafka:${versions.testcontainers}"
  testImplementation "org.rnorth.duct-tape:duct-tape:${versions.ducttape}"
  testImplementation "org.apache.commons:commons-compress:${versions.commonscompress}"
  testImplementation "commons-io:commons-io:${versions.commonsio}"
}

internalClusterTest{
  environment 'TESTCONTAINERS_RYUK_DISABLED', 'true'
}

thirdPartyAudit {
  ignoreMissingClasses(
    'com.fasterxml.jackson.databind.JsonNode',
    'com.fasterxml.jackson.databind.ObjectMapper',
    'com.fasterxml.jackson.databind.node.ArrayNode',
    'com.fasterxml.jackson.databind.node.BooleanNode',
    'com.fasterxml.jackson.databind.node.JsonNodeFactory',
    'com.fasterxml.jackson.databind.node.JsonNodeType',
    'com.fasterxml.jackson.databind.node.NullNode',
    'com.fasterxml.jackson.databind.node.ObjectNode',
    'net.jpountz.lz4.LZ4Compressor',
    'net.jpountz.lz4.LZ4Factory',
    'net.jpountz.lz4.LZ4SafeDecompressor',
    'net.jpountz.util.SafeUtils',
    'net.jpountz.xxhash.XXHash32',
    'net.jpountz.xxhash.XXHashFactory',
    'org.slf4j.impl.StaticLoggerBinder',
    'org.slf4j.impl.StaticMDCBinder',
    'org.slf4j.impl.StaticMarkerBinder',
  )
}
