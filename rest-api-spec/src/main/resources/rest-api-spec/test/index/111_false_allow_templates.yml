---
"Index documents with setting dynamic parameter to false_allow_templates in the mapping of the index":
  - skip:
      version: " - 3.11.99"
      reason: "introduced in 3.2.0"

  - do:
      indices.create:
        index:    test_1
        body:
          mappings:
            dynamic: false_allow_templates
            dynamic_templates: [
              {
                dates: {
                  "match": "date_*",
                  "match_mapping_type": "date",
                  "mapping": {
                    "type": "date"
                  }
                }
              },
              {
                strings: {
                  "match": "stringField*",
                  "match_mapping_type": "string",
                  "mapping": {
                    "type": "keyword"
                  }
                }
              },
              {
                object: {
                  "match": "objectField*",
                  "match_mapping_type": "object",
                  "mapping": {
                    "type": "object",
                    "properties": {
                      "bar1": {
                        "type": "keyword"
                      },
                      "bar2": {
                        "type": "text"
                      }
                    }
                  }
                }
              }
            ]
            properties:
              url:
                type: keyword

  - do:
      index:
        index:   test_1
        id:      1
        body:    {
          url: "https://example.com",
          date_timestamp: "2024-06-25T05:11:51.243Z",
          stringField: "bar",
          objectField: {
            bar1: "bar1",
            bar2: "bar2"
          },
          author: "John Doe"
        }

  - do:
      get:
        index: test_1
        id: 1
  - match: 
      _source: 
        url: "https://example.com"
        date_timestamp: "2024-06-25T05:11:51.243Z"
        stringField: "bar"
        objectField:
          bar1: "bar1"
          bar2: "bar2"

  - do:
      indices.get_mapping:
        index: test_1

  - match: {test_1.mappings.dynamic:     false_allow_templates}
  - match: {test_1.mappings.properties.url.type:     keyword}
  - match: {test_1.mappings.properties.date_timestamp.type:     date}
  - match: {test_1.mappings.properties.stringField.type:     keyword}
  - match: {test_1.mappings.properties.objectField.properties.bar1.type:     keyword}
  - match: {test_1.mappings.properties.objectField.properties.bar2.type:     text} 