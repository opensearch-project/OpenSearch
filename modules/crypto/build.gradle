/*
 * SPDX-License-Identifier: Apache-2.0
 *
 * The OpenSearch Contributors require contributions made to
 * this file be licensed under the Apache-2.0 license or a
 * compatible open source license.
 */

apply plugin: 'opensearch.build'
apply plugin: 'opensearch.publish'

forbiddenApis.ignoreFailures = false

thirdPartyAudit.enabled = false
forbiddenApisTest.ignoreFailures = true
testingConventions.enabled = false

opensearchplugin {
  description 'Crypto module plugin for providing encryption and decryption support.'
  classname 'org.opensearch.encryption.CryptoModulePlugin'
}

dependencies {
  // Common crypto classes
  api project(':libs:opensearch-common')

  implementation "com.amazonaws:aws-encryption-sdk-java:1.7.0"
  implementation "org.bouncycastle:bcprov-jdk15to18:${versions.bouncycastle}"
  implementation "org.apache.commons:commons-lang3:${versions.commonslang}"

  //Tests
  testImplementation "junit:junit:${versions.junit}"
  testImplementation "org.hamcrest:hamcrest:${versions.hamcrest}"
  testImplementation(project(":test:framework")) {
    exclude group: 'org.opensearch', module: 'opensearch-encryption-sdk'
  }

  compileOnly 'com.google.code.findbugs:annotations:3.0.1'
}

tasks.named('forbiddenApisMain').configure {
  // Only enable limited check because AD code has too many violations.
  replaceSignatureFiles 'jdk-signatures'
  signaturesFiles += files('src/forbidden/crypto-signatures.txt')
}

// Encryption SDK files have missing java docs so disabling for the lib.
tasks.named('missingJavadoc').configure {
  enabled = false
}

forbiddenApisTest.setSignaturesFiles(files('src/forbidden/crypto-test-signatures.txt'))
