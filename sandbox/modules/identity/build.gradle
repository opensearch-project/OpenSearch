/*
 * SPDX-License-Identifier: Apache-2.0
 *
 * The OpenSearch Contributors require contributions made to
 * this file be licensed under the Apache-2.0 license or a
 * compatible open source license.
 */

apply plugin: 'opensearch.internal-cluster-test'

opensearchplugin {
  description 'Plugin for identity features in OpenSearch.'
  classname 'org.opensearch.identity.IdentityPlugin'
  name project.name
  licenseFile rootProject.file('licenses/APACHE-LICENSE-2.0.txt')
  noticeFile rootProject.file('NOTICE.txt')
}

dependencies {
  api project(':libs:opensearch-core')
  api project(':sandbox:libs:opensearch-authn')

  implementation 'org.greenrobot:eventbus:3.2.0'
  implementation 'commons-cli:commons-cli:1.3.1'

  testImplementation project(path: ':modules:transport-netty4') // for http
  testImplementation project(path: ':plugins:transport-nio') // for http
}

//task integTest(type: RestIntegTestTask) {
//  systemProperty 'opensearch.set.netty.runtime.available.processors', 'false'
//}
// TODO move the integ tests into qa module after this is moved out of sandbox?
/*
 * We have to disable setting the number of available processors as tests in the same JVM randomize processors and will step on each
 * other if we allow them to set the number of available processors as it's set-once in Netty.
 */
test {
  systemProperty 'opensearch.set.netty.runtime.available.processors', 'false'
}

internalClusterTest {
  systemProperty 'opensearch.set.netty.runtime.available.processors', 'false'
}

thirdPartyAudit.ignoreMissingClasses(
  'android.app.Activity',
  'android.app.AlertDialog$Builder',
  'android.app.Dialog',
  'android.app.DialogFragment',
  'android.app.Fragment',
  'android.app.FragmentManager',
  'android.app.FragmentTransaction',
  'android.content.Context',
  'android.content.DialogInterface',
  'android.content.DialogInterface$OnClickListener',
  'android.content.res.Resources',
  'android.os.Build$VERSION',
  'android.os.Bundle',
  'android.os.Handler',
  'android.os.Looper',
  'android.os.Message',
  'android.os.SystemClock',
  'android.support.v4.app.DialogFragment',
  'android.support.v4.app.Fragment',
  'android.support.v4.app.FragmentActivity',
  'android.support.v4.app.FragmentManager',
  'android.support.v4.app.FragmentTransaction',
  'android.util.Log',
)
